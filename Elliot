--// Services
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Remote = ReplicatedStorage:WaitForChild("Modules"):WaitForChild("Network"):WaitForChild("RemoteEvent")
local HRP = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") or LocalPlayer.CharacterAdded:Wait():WaitForChild("HumanoidRootPart")

--// Variables
local Mode = "Legit"
local Range = 15
local LastPos = HRP.Position
local ActiveNotifs = {}
local MaxNotifs = 3
local RangeOptions = {10,15,20,25,30}

--// Functions
local function GetNearestTarget(maxRange)
    local closest, dist = nil, maxRange
    for _, plr in pairs(Players:GetPlayers()) do
        if plr ~= LocalPlayer and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
            local hum = plr.Character:FindFirstChildOfClass("Humanoid")
            if hum and hum.Health > 0 and hum.Health <= 20 then
                local mag = (plr.Character.HumanoidRootPart.Position - HRP.Position).Magnitude
                if mag < dist then
                    dist = mag
                    closest = plr.Character
                end
            end
        end
    end
    return closest
end

local function ThrowPizza(target)
    if target then
        Remote:FireServer("UseActorAbility", "ThrowPizza", target.HumanoidRootPart.Position)
        -- Badge Notification
        local sound = Instance.new("Sound")
        sound.SoundId = "rbxassetid://138087103"
        sound.Volume = 1
        sound.Parent = game:GetService("SoundService")
        sound:Play()
        task.delay(2,function() sound:Destroy() end)

        if #ActiveNotifs >= MaxNotifs then
            local oldest = table.remove(ActiveNotifs,1)
            if oldest and oldest.Destroy then
                oldest:TweenPosition(UDim2.new(1.2,0,1,-20),"In","Quad",0.4,true,function() oldest.Parent:Destroy() end)
            end
        end

        local ScreenGui = Instance.new("ScreenGui")
        ScreenGui.Parent = game:GetService("CoreGui")
        local Frame = Instance.new("Frame",ScreenGui)
        Frame.AnchorPoint = Vector2.new(1,1)
        Frame.Size = UDim2.new(0,250,0,60)
        Frame.BackgroundColor3 = Color3.fromRGB(30,30,30)
        Frame.BackgroundTransparency = 0.1
        Frame.BorderSizePixel = 0
        Frame.ClipsDescendants = true
        Frame.ZIndex = 5

        local Label = Instance.new("TextLabel",Frame)
        Label.Size = UDim2.new(1,-20,1,-20)
        Label.Position = UDim2.new(0,10,0,10)
        Label.BackgroundTransparency = 1
        Label.Font = Enum.Font.GothamBold
        Label.TextSize = 14
        Label.TextColor3 = Color3.fromRGB(255,255,255)
        Label.Text = "üçï Thrown Pizza"
        Label.TextXAlignment = Enum.TextXAlignment.Left

        table.insert(ActiveNotifs,Frame)
        for i, notif in ipairs(ActiveNotifs) do
            notif:TweenPosition(UDim2.new(1,-20,1,-20 - ((i-1)*70)),"Out","Quad",0.4,true)
        end

        -- Auto-remove
        task.delay(3,function()
            for i, notif in ipairs(ActiveNotifs) do
                if notif==Frame then
                    table.remove(ActiveNotifs,i)
                    Frame:TweenPosition(UDim2.new(1.2,0,1,-20 - ((i-1)*70)),"In","Quad",0.4,true,function() ScreenGui:Destroy() end)
                    break
                end
            end
            for j, notif in ipairs(ActiveNotifs) do
                notif:TweenPosition(UDim2.new(1,-20,1,-20 - ((j-1)*70)),"Out","Quad",0.4,true)
            end
        end)
    end
end

--// UI
local ScreenGui = Instance.new("ScreenGui",LocalPlayer:WaitForChild("PlayerGui"))
ScreenGui.Name = "PizzaUI"
local Frame = Instance.new("Frame",ScreenGui)
Frame.Size = UDim2.new(0,200,0,180)
Frame.Position = UDim2.new(0.4,0,0.3,0)
Frame.BackgroundColor3 = Color3.fromRGB(20,20,20)
Frame.Active = true
Frame.Draggable = true

local CloseBtn = Instance.new("TextButton",Frame)
CloseBtn.Size = UDim2.new(0,180,0,25)
CloseBtn.Position = UDim2.new(0,10,0,5)
CloseBtn.Text = "Close"
CloseBtn.BackgroundColor3 = Color3.fromRGB(150,0,0)

local Status = Instance.new("TextLabel",Frame)
Status.Size = UDim2.new(0,180,0,25)
Status.Position = UDim2.new(0,10,0,35)
Status.Text = "Mode: "..Mode.." | Range: "..Range
Status.BackgroundTransparency = 1
Status.TextColor3 = Color3.fromRGB(255,255,255)

local ModeDropdown = Instance.new("TextButton",Frame)
ModeDropdown.Size = UDim2.new(0,180,0,25)
ModeDropdown.Position = UDim2.new(0,10,0,65)
ModeDropdown.Text = "Mode: "..Mode

local RangeDropdown = Instance.new("TextButton",Frame)
RangeDropdown.Size = UDim2.new(0,180,0,25)
RangeDropdown.Position = UDim2.new(0,10,0,95)
RangeDropdown.Text = "Range: "..Range

local TriggerBtn = Instance.new("TextButton",Frame)
TriggerBtn.Size = UDim2.new(0,180,0,30)
TriggerBtn.Position = UDim2.new(0,10,0,130)
TriggerBtn.Text = "Trigger Pizza"
TriggerBtn.BackgroundColor3 = Color3.fromRGB(0,150,0)

--// UI Logic
CloseBtn.MouseButton1Click:Connect(function()
    Frame.Visible = not Frame.Visible
    CloseBtn.Text = Frame.Visible and "Close" or "Open"
end)

ModeDropdown.MouseButton1Click:Connect(function()
    Mode = (Mode=="Legit") and "Auto" or "Legit"
    ModeDropdown.Text = "Mode: "..Mode
    Status.Text = "Mode: "..Mode.." | Range: "..Range
end)

RangeDropdown.MouseButton1Click:Connect(function()
    local currentIndex = table.find(RangeOptions,Range) or 2
    local nextIndex = (currentIndex % #RangeOptions) +1
    Range = RangeOptions[nextIndex]
    RangeDropdown.Text = "Range: "..Range
    Status.Text = "Mode: "..Mode.." | Range: "..Range
end)

TriggerBtn.MouseButton1Click:Connect(function()
    LastPos = HRP.Position
    if Mode=="Legit" then
        local target = GetNearestTarget(15)
        if target then
            ThrowPizza(target)
        end
    else
        local target = GetNearestTarget(Range)
        if target then
            ThrowPizza(target)
            task.delay(1,function()
                if HRP then HRP.CFrame = CFrame.new(LastPos) end
            end)
        end
    end
end)
